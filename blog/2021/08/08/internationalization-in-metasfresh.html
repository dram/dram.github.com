<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>metasfresh的多语言处理</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">metasfresh的多语言处理</h1><time>08 Aug 2021</time><div><p>本文以metasfresh的主菜单为例，介绍metasfresh的多语言处理机制。</p><p>metasfresh的多语言数据存放在数据库中，包括两份数据：基础语言数据和翻译数据。界面文本呈现时的核心逻辑是判断当前语言是否是基础语言，如果是，则不获取翻译数据，如果不是，则获取。metasfresh的基础语言是德语，例如数据库表<code>AD_Menu</code>中的<code>name</code>字段，就有大量德语。</p><p>对于基础语言的判断处理，主要在<code>de.metas.i18n.Language.isBaseLanguage()</code>。</p><p>再来看一下主菜单中文本的处理，文本相关的代码主要是在<code>org.compiere.model.MTree.getNodeDetails()</code>接口，其中调用了<code>org.adempiere.model.tree.spi.IPOTreeSupport.getNodeInfoSelectSQL()</code>，返回菜单项信息，针对不同语言，返回的SQL语句不同，可能关联翻译表中的信息。</p><p>另外，<code>IPOTreeSupport</code>包含多个实现，不同的实现，适用于不同的数据库，具体的关联在<code>de.metas.modelvalidator.SwatValidator.initialize()</code>注册。</p><p>例如主菜单的文本，通过以下语句关联<code>MenuTreeSupport</code>：</p><pre><code>Services.get(IPOTreeSupportFactory.class).register(I_AD_Menu.Table_Name, MenuTreeSupport.class);</code></pre></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>