<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>OFBiz系统安装配置</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">OFBiz系统安装配置</h1><time>26 Jun 2021</time><div><p>OFBiz的安装相对简单，这里做简要说明。</p><div class="section"><h2 class="sectiontitle">配置数据库</h2><p>OFBiz内置有Derby数据库，可作为开发测试用，如果要生产使用，首先需要配置数据库。具体配置文件在<span class="filepath">framework/entity/config/entityengine.xml</span>，以下以PostgreSQL为例。</p><ol><li>创建ofbiz数据库；</li><li>创建ofbiz用户，密码设置为ofbiz；</li><li>将ofbiz所有者调整为ofbiz；</li><li>从<a href="https://jdbc.postgresql.org/" target="_blank">这里</a>下载PostgreSQL JDBC插件，存放到<span class="filepath">ofbiz-framework/lib</span>目录；</li><li>调整<span class="filepath">entityengine.xml</span>中name属性为default的delegator，将<code>localderby</code>调整为<code>localpostgres</code>；</li></ol></div><div class="section"><h2 class="sectiontitle">编译</h2><p>在完成数据库配置后，执行以下命令完成系统编译：</p><pre class="screen">./gradlew jar</pre></div><div class="section"><h2 class="sectiontitle">初始化</h2><p>首先创建<span class="filepath">initial.xml</span>文件，内容如下：</p><pre><code>&lt;entity-engine-xml&gt;
  &lt;Party partyId="admin" partyTypeId="PERSON" statusId="PARTY_ENABLED"/&gt;
  &lt;PartyRole partyId="admin" roleTypeId="CAL_OWNER"/&gt;
  &lt;UserLogin userLoginId="admin" partyId="admin" currentPassword="{SHA}47ca69ebb4bdc9ae0adec130880165d2cc05db1a" lastLocale="en"/&gt;
  &lt;UserLoginSecurityGroup groupId="SUPER" userLoginId="admin" fromDate="2001-01-01 12:00:00.0"/&gt;
  &lt;UserPreference userLoginId="admin" userPrefTypeId="VISUAL_THEME" userPrefGroupTypeId="GLOBAL_PREFERENCES" userPrefValue="FLAT_GREY"/&gt;
&lt;/entity-engine-xml&gt;
</code></pre><p>之后执行以下命令完成初始化：</p><pre class="screen">java -jar build/libs/ofbiz.jar -l readers=seed -l file=initial.xml</pre></div><div class="section"><h2 class="sectiontitle">运行</h2><p>完成上述配置后，执行以下命令启动服务：</p><pre class="screen">java -jar build/libs/ofbiz.jar</pre><p>如果是用于开发，可以用<span class="cmdname">./gradlew ofbiz</span>启动。</p><p>服务启动后，可以通过<code>https://localhost:8443/webtools</code>访问。至于其他的命令参数，可以通过<span class="cmdname">java -jar build/libs/ofbiz.jar --help</span>查询。</p></div><div class="section"><h2 class="sectiontitle">配置</h2><ul><li><p>允许HTTP访问</p><p>OFBiz默认禁止HTTP访问，调整<span class="filepath">framework/webapp/config/url.properties</span>中的<code>no.http</code>和<code>port.https.enabled</code>属性可以启用。</p></li><li><p>禁用输入检查</p><p>OFBiz默认对用户输入有严格的检查，通过调整<span class="filepath">framework/base/config/owasp.properties</span>中的<code>sanitizer.enable</code>属性可以放宽限制。</p></li><li><p>服务Host域名</p><p>OFBiz默认对服务域名有限制，可以通过<span class="filepath">framework/security/config/security.properties</span>中的<code>host-headers-allowed</code>属性调整。</p></li><li><p>禁用externalLoginKey</p><p>为支持在应用之间切换时保持会话，OFBiz默认通过在URL中追加<code>externalLoginKey</code>参数实现。可以通过<span class="filepath">framework/security/config/security.properties</span>中的<code>security.login.tomcat.sso</code>和<code>security.login.externalLoginKey.enabled</code>调整为Tomcat的SSO机制。</p></li></ul></div></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>