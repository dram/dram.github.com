<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>WSL中Java服务对127.0.1和localhost的不同处理</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">WSL中Java服务对127.0.1和localhost的不同处理</h1><time>26 Jun 2021</time><div><p>问题起因是发现OFBiz在WSL环境中无法以127.0.0.1地址访问，但使用localhost访问是正常的。后来进一步排查发现Tomcat的服务存在一样的问题，再进而发现直接以<code>com.sun.net.httpserver.HttpServer</code>启动的服务也是如此。</p><p>经过排查，更深层的原因是IPv4和IPv6的问题，运行于WSL中的未指定监听地址的Java服务，只接受IPv6的请求。比如在浏览器中请求<code>http://[::1]:8000/</code>是可以访问的。</p><p>这涉及到<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/net/ipv6_guide/" target="_blank">Java对IPv4和IPv6的处理</a>，以及Windows的协议栈实现，以及WSL对Linux内核接口的实现。</p><p><a href="https://stackoverflow.com/questions/10378471/how-to-support-both-ipv4-ipv6-on-java" target="_blank">这里</a>有对Java的相关讨论，以及这里对<a href="https://www.williamjbowman.com/blog/2020/04/25/running-a-public-server-from-wsl-2/" target="_blank">WSL</a>的讨论，可以作为参考。</p><p>问题的根因还需要进一步深入分析，另外操作系统在解析localhost域名时，如何选择IPv4还是IPv6呢？这也是一个待分析的问题。</p></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>