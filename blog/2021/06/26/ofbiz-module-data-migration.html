<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>OFBiz模块数据迁移（WorkEffort为例）</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">OFBiz模块数据迁移（WorkEffort为例）</h1><time>26 Jun 2021</time><div><div class="section"><p>在OFBiz系统重新部署时，有时会涉及到数据迁移问题，以下以<dfn class="term">WorkEffort</dfn>模块为例，介绍数据迁移的流程。</p></div><div class="section"><h2 class="sectiontitle">系统初始化</h2><p>在数据迁移前，需要在初始安装系统中导入部分必要的数据，以支持后续导入数据与之关联。主要包括：</p><ul><li><code>Party</code> - 当事人定义；</li><li><code>PartyRole</code> - 当事人角色定义，包含日历权限<code>CAL_OWNER</code>；</li><li><code>UserLogin</code> - 用户登录定义，包含登录信息，以及和<code>Party</code>的关联信息；</li><li><code>UserLoginSecurityGroup</code> - 用户登录安全组定义。</li></ul><p>以下是基于<dfn class="term">entity-engine-xml</dfn>定义的详细数据：</p><pre><code>&lt;entity-engine-xml&gt;
  &lt;Party partyId="admin" partyTypeId="PERSON" statusId="PARTY_ENABLED"/&gt;
  &lt;PartyRole partyId="admin" roleTypeId="CAL_OWNER"/&gt;
  &lt;UserLogin userLoginId="admin" partyId="admin" currentPassword="{SHA}47ca69ebb4bdc9ae0adec130880165d2cc05db1a" requirePasswordChange="N"/&gt;
  &lt;UserLoginSecurityGroup groupId="SUPER" userLoginId="admin" fromDate="2001-01-01 12:00:00.0"/&gt;
&lt;/entity-engine-xml&gt;</code></pre><p>该数据可使用如下命令在系统数据初始化时导入：</p><pre><code>./gradlew "ofbiz -l readers=seed -l file=data.xml"</code></pre></div><div class="section"><h2 class="sectiontitle">数据迁移</h2><p>在完成系统初始化后，可开始数据库表数据的迁移工作：</p><ul><li><code>work_effort</code> - 工作计划主数据；</li><li><code>work_effort_party_assignment</code> - 工作计划当事人分派；</li><li><code>note_data</code> - 注释主数据；</li><li><code>work_effort_note</code> - 工作计划和注释关联；</li><li><code>sequence_value_item</code> - 自增ID偏移。</li></ul></div></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>