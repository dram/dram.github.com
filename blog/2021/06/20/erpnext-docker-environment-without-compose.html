<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>手动搭建ERPNext Docker环境</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">手动搭建ERPNext Docker环境</h1><time>20 Jun 2021</time><div><p>本文介绍在Windows下基于<a href="https://www.docker.com/products/docker-desktop" target="_blank">Docker Desktop</a>手动搭建ERPNext测试环境的简要流程（未使用Docker Compose）。</p><div class="section"><h2 class="sectiontitle">获取镜像</h2><p>首先获取ERPNext以及相关依赖服务的Docker镜像，为后续启动服务做准备。</p><pre><code>docker pull mariadb:10.3
docker pull redis:6.2-alpine
docker pull frappe/erpnext-worker:v13
docker pull frappe/frappe-socketio:v13
docker pull frappe/erpnext-nginx:v13</code></pre></div><div class="section"><h2 class="sectiontitle">启动服务</h2><p>依序启动以下各服务，其中涉及的IP可通过<span class="cmdname">docker inspect</span>命令查询，以MariaDB为例：</p><pre><code>docker inspect mariadb | select-string -pattern "IPAddress"</code></pre><ol><li><p>启动数据库：</p><pre><code>docker run -d --name mariadb -e MARIADB_ROOT_PASSWORD=erpnext mariadb:10.3 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</code></pre></li><li><p>启动Redis：</p><pre><code>docker run -d --name redis redis:6.2-alpine</code></pre></li><li><p>启动ERPNext：</p><pre><code>docker run -d --name erpnext-worker -v c:/erpnext-sites:/home/frappe/frappe-bench/sites -e "MARIADB_HOST=172.17.0.2" -e "REDIS_CACHE=172.17.0.3" -e "REDIS_QUEUE=172.17.0.3" -e "REDIS_SOCKETIO=172.17.0.3" -e "SOCKETIO_PORT=9000" frappe/erpnext-worker:v13</code></pre></li><li><p>启动SocketIO：</p><pre><code>docker run -d --name erpnext-socketio -v c:/erpnext-sites:/home/frappe/frappe-bench/sites frappe/frappe-socketio:v13</code></pre></li><li><p>启动NGINX：</p><pre><code>docker run -d --name erpnext-nginx -p 8000:80 -v c:/erpnext-sites:/var/www/html/sites -e "FRAPPE_PY=172.17.0.4" -e "FRAPPE_SOCKETIO=172.17.0.5" frappe/erpnext-nginx:v13</code></pre></li></ol></div><div class="section"><h2 class="sectiontitle">创建站点</h2><pre><code>docker exec -it erpnext-worker bench new-site localhost
docker exec -it erpnext-worker bench --site localhost install-app erpnext</code></pre></div><div class="section"><h2 class="sectiontitle">同步静态文件（耗时较长）</h2><pre><code>docker exec erpnext-nginx rsync -a --delete /var/www/html/assets /var/www/html/sites</code></pre></div><div class="section"><h2 class="sectiontitle">整合镜像（非官方）</h2><p>另外，有非官方的整合镜像，如果只是用于测试或演示环境的话，相对要简化许多。</p><pre><code>docker pull pipech/erpnext-docker-debian:13-F5.0_E5.0-py3
docker run -d -p 8000:8000 -p 9000:9000 --add-host secure.gravatar.com:127.0.0.1 pipech/erpnext-docker-debian:13-F5.0_E5.0-py3</code></pre></div></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>