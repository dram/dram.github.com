<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>Frappe和ERPNext安装部署</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">Frappe和ERPNext安装部署</h1><time>20 Jun 2021</time><div><p>本文主要整理说明安装ERPNext v13的主要流程，以Ubuntu 20.04基础系统为例。</p><div class="section"><h2 class="sectiontitle">系统环境准备</h2><ol><li><p>安装基础依赖包：</p><pre><code>apt install git mariadb-server redis-server wkhtmltopdf</code></pre></li><li><p>安装Python库相关依赖包：</p><pre><code>apt install libmysqlclient-dev python3-dev python3-pip</code></pre></li><li><p>安装JavaScript库相关依赖包：</p><pre><code>apt install phantomjs python2 xvfb</code></pre></li><li><p>安装v12版本Node.js环境：</p><pre><code>wget https://nodejs.org/dist/v12.22.1/node-v12.22.1-linux-x64.tar.xz
tar xf node-v12.22.1-linux-x64.tar.xz
ln -s $PWD/node-v12.22.1-linux-x64/bin/node $HOME/.local/bin/
ln -s $PWD/node-v12.22.1-linux-x64/bin/npm $HOME/.local/bin/
npm install -g yarn</code></pre></li></ol></div><div class="section"><h2 class="sectiontitle">数据库初始化配置</h2><ol><li><p>调整MariaDB配置文件<span class="filepath">/etc/mysql/my.cnf</span>：</p><pre><code>[mysqld]
character-set-client-handshake = FALSE
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

[mysql]
default-character-set = utf8mb4</code></pre></li><li><p>启动MariaDB服务：</p><pre><code>service mysql start</code></pre></li><li><p>运行<span class="cmdname">mysql_secure_installation</span>初始化MariaDB。</p></li><li><p>调整MariaDB的root访问权限：</p><pre><code>UPDATE mysql.user SET plugin = '' WHERE user = 'root' AND plugin = 'unix_socket';
FLUSH PRIVILEGES;</code></pre></li></ol></div><div class="section"><h2 class="sectiontitle">Frappe和ERPNext安装</h2><ol><li><p>Frappe安装（之后所有命令在<span class="filepath">frappe-bench</span>目录中执行）：</p><pre><code>bench init --verbose --frappe-branch version-13 --skip-assets frappe-bench</code></pre></li><li><p>ERPNext安装：</p><pre><code>bench get-app --branch version-13 --skip-assets https://github.com/frappe/erpnext.git</code></pre></li><li><p>编译资源文件：</p><pre><code>bench build --force</code></pre></li><li><p>创建初始站点：</p><pre><code>bench new-site example.com
bench --site example.com install-app erpnext</code></pre></li></ol></div><div class="section"><h2 class="sectiontitle">微调</h2><ul><li><p>在<span class="filepath">/etc/hosts</span>添加以下条目，限制后台访问Gravatar服务（感觉可以建议官方在<span class="filepath">sites/common_site_config.json</span>中添加<code>enable_gravatar</code>配置项）：</p><pre><code>127.0.0.1 secure.gravatar.com</code></pre></li><li><p>解决创建用户失败的问题，修改<span class="filepath">Procfile</span>（详见<a href="https://github.com/frappe/frappe/issues/12378" target="_blank">这里</a>的讨论）：</p><pre><code>web: bench serve --port 8000 --noreload</code></pre></li></ul></div></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>