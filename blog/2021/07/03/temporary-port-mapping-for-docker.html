<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>Docker临时端口映射</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">Docker临时端口映射</h1><time>03 Jul 2021</time><div><p>有两个方案可以在Docker环境中实现临时端口映射，一是基于NGINX或者HAProxy的TCP代理，二是基于OpenSSH的端口转发，相对来说，前者安全性更高。</p><div class="section"><h2 class="sectiontitle">NGINX</h2><p>通过以下命令启用NGINX以实现端口映射，其中映射了<code>5432</code>和<code>8069</code>端口：</p><pre><code>docker run -d --name nginx --publish 5432:5432 --publish 8069:8069 nginx:1.20-alpine
docker exec nginx sh -c "echo 'events {} stream { server { listen 5432; proxy_pass 172.17.0.2:5432; } server { listen 8069; proxy_pass 172.17.0.3:8069; } }' &gt; /etc/nginx/nginx.conf"
docker restart nginx</code></pre></div><div class="section"><h2 class="sectiontitle">OpenSSH</h2><p>OpenSSH方案如下，先基于以下命令启用Docker实例：</p><pre><code>docker run -d --name=openssh -p 2222:2222 -e DOCKER_MODS=linuxserver/mods:openssh-server-ssh-tunnel -e PASSWORD_ACCESS=true -e USER_PASSWORD=admin -e USER_NAME=admin linuxserver/openssh-server</code></pre><p>之后通过以下命令打开ssh通道：</p><pre><code>ssh -N -p2222 -L5430:172.17.0.2:5432 admin@127.0.0.1</code></pre></div></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>