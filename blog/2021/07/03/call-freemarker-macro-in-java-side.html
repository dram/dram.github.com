<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>FreeMarker中实现Java端调用模块端宏</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">FreeMarker中实现Java端调用模块端宏</h1><time>03 Jul 2021</time><div><p>FreeMarker虽然提供有丰富的Java接口，但在实现Java端调用模块端宏这一功能点上，并没有很好的支持。虽然可以通过<code>Environment.getVariable</code>通过宏名称获取到<code>Macro</code>对象，但<code>Macro</code>整个类都已经被弃用了。</p><p>本文介绍通过<code>Environment.setVariable</code>传入变量结合<code>with_args</code>调用宏的方法，变通地实现宏调用。</p><p>具体思路是先通过<code>Environment.setVariable</code>将参数以字典形式传入，例如<code>$args$macroName</code>，然后在该环境中渲染模板<code>&lt;@%s?with_args($args$macroName)/&gt;</code>。</p><p>在参数传入中，可以通过<code>DefaultObjectWrapper</code>实现Java数据类型和FreeMarker数据类型之间的自动转化。</p></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>