<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>Scipio ERP安装配置</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">Scipio ERP安装配置</h1><time>03 Jul 2021</time><div><p><a href="https://www.scipioerp.com/" target="_blank">Scipio ERP</a>是OFBiz的一个分支，相较于OFBiz，Scipio ERP对部分模块做了简化，而在网上商城部分做了增强。</p><p>本文简要介绍其安装配置流程。</p><div class="section"><h2 class="sectiontitle">下载源码</h2><p>可直接从GitHub获取源码：</p><pre class="screen">git clone https://github.com/ilscipio/scipio-erp.git</pre></div><div class="section"><h2 class="sectiontitle">配置数据库</h2><p>Scipio内置有Derby数据库，可作为开发测试用，生产环境建议配置外部数据库。具体配置文件在<span class="filepath">framework/entity/config/entityengine.xml</span>，以下以PostgreSQL为例。</p><ol><li>创建ofbiz数据库；</li><li>创建ofbiz用户，密码设置为ofbiz；</li><li>将ofbiz所有者调整为ofbiz；</li><li>执行命令<span class="cmdname">./ant download-jdbc-postgresql</span>以下载PostgreSQL的JDBC驱动；</li><li>调整<span class="filepath">entityengine.xml</span>中<code>name="default"</code>的delegator，将<code>localderby</code>调整为<code>localpostgres</code>；</li></ol></div><div class="section"><h2 class="sectiontitle">编译系统</h2><p>基于以下命令编译（Scipio的编译管理系统基于Ant和Ivy构建，速度较慢）：</p><pre class="screen">./ant build</pre><p>在完成初次编译之后，因为Ivy缓存构建完成，可以开启<span class="filepath">build.xml</span>中的<code>lib.update.bypass</code>，以在后续编译时跳过Ivy缓存更新检测。</p></div><div class="section"><h2 class="sectiontitle">数据初始化</h2><p>首先创建<span class="filepath">initial.xml</span>文件，内容如下：</p><pre><code>&lt;entity-engine-xml&gt;
  &lt;Party partyId="admin" partyTypeId="PERSON" statusId="PARTY_ENABLED"/&gt;
  &lt;PartyRole partyId="admin" roleTypeId="CAL_OWNER"/&gt;
  &lt;UserLogin userLoginId="admin" partyId="admin" currentPassword="{SHA}47ca69ebb4bdc9ae0adec130880165d2cc05db1a" lastLocale="en"/&gt;
  &lt;UserLoginSecurityGroup groupId="SUPER" userLoginId="admin" fromDate="2001-01-01 12:00:00.0"/&gt;
&lt;/entity-engine-xml&gt;</code></pre><p>之后执行以下命令完成初始化：</p><pre class="screen">java -jar ofbiz.jar load-data readers=seed file=initial.xml</pre><p><span class="cmdname">load-seed</span>只是做了核心数据的初始化，<span class="filepath">initial.xml</span>文件中包含了额外需要的配置。</p></div><div class="section"><h2 class="sectiontitle">启动服务</h2><p>通过<span class="cmdname">java -jar ofbiz.jar</span>启动服务。</p></div><div class="section"><h2 class="sectiontitle">配置</h2><ul><li><p>禁用Solr</p><p>Scipio集成了Solr，主要用于<span class="filepath">/shop</span>网站，如果不需要使用，可以在<span class="filepath">applications/solr/config/solrconfig.properties</span>中禁用，同时在<span class="filepath">applications/solr/scipio-component.xml</span>对ofbiz-component标签添加<code>enabled="false"</code>属性以禁用<span class="filepath">/solr</span>页面。</p></li><li><p>禁用externalLoginKey</p><p>为支持在应用之间切换时保持会话，Scipio默认通过在URL中追加<code>externalLoginKey</code>参数实现。可以通过<span class="filepath">framework/security/config/security.properties</span>中的<code>security.login.tomcat.sso</code>和<code>security.login.externalLoginKey.enabled</code>调整为Tomcat的SSO机制。</p></li><li><p>允许HTTP访问</p><p>Scipio默认只支持HTTPS访问，调整以下两项配置，可以允许HTTP访问：</p><ol><li>禁用<span class="filepath">framework/webapp/config/url.properties</span>中的<code>port.https.enabled</code>属性；</li><li>设置<span class="filepath">framework/webapp/config/requestHandler.properties</span>中的<code>secure-redirect-url-format</code>属性值为<code>ofbiz-url</code>；</li></ol></li><li><p>优化页面渲染</p><p>删除<span class="filepath">framework/common/webcommon/includes/commonHeadScripts.ftl</span>中<code>scipioStyles</code>一行。</p><p>这一数据的功能是传递样式到浏览器端，用于JavaScript对样式的处理。猜测主要用于另外几款收费的样式，因为自带样式中引用其中变量的地方并不多。</p><p>但这一数据渲染后的JSON字典数据大小为37KB，这个体积对服务端页面生成、网络传输、浏览器端页面渲染都有一定影响了，所以可以考虑去除。</p><pre class="screen">sed -i '/scipioStyles/d' framework/common/webcommon/includes/commonHeadScripts.ftl</pre></li></ul></div></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>