<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/images/favicon.png"><title>Tomcat过滤Host头</title></head><body><header><span id="site-name"><a href="/">dram.me</a></span><nav><ul><li><a href="/blog/about.html">About</a></li><li><a href="/logo/">LOGO</a></li></ul></nav></header><article><h1 class="topictitle1" id="ariaid-title1">Tomcat过滤Host头</h1><time>25 Jul 2021</time><div><p>OFBiz在e0f0d52中添加了host-headers-allowed配置项，用于限制访问的Host头。但灵活度不高，觉得这个配置的功能应该在tomcat层面可以处理。如Tomcat支持对请求信息<a href="https://tomcat.apache.org/tomcat-9.0-doc/config/context.html#Request_Filters" target="_blank">过滤</a>。</p><p>在Tomcat中，同时存在Filter和Valve两种机制，两者的区别可以参考这里的<a href="https://stackoverflow.com/questions/5537467/difference-between-a-valve-and-a-filter" target="_blank">讨论</a>。可以基于<a href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/valves/RequestFilterValve.html" target="_blank">RequestFilterValve</a>实现，定义基于Host的过滤，设置<code>setAllow</code>值。</p><p>另一个思路是基于<a href="https://tomcat.apache.org/tomcat-9.0-doc/virtual-hosting-howto.html" target="_blank">虚拟主机</a>处理，将defaultHost设置<code>RemoteAddrValve</code>为拒绝任何访问。</p><p>一些Web框架有类似的功能，例如Django用ALLOWED_HOSTS。</p></div></article><footer><p>Copyright © 2021 Xin Wang</p></footer></body></html>